{
  "id": "1622",
  "title": "Fancy Sequence",
  "slug": "fancy-sequence",
  "difficulty": "Hard",
  "category": "Algorithms",
  "content_html": "<p>Write an API that generates fancy sequences using the <code>append</code>, <code>addAll</code>, and <code>multAll</code> operations.</p>\n\n<p>Implement the <code>Fancy</code> class:</p>\n\n<ul>\n\t<li><code>Fancy()</code> Initializes the object with an empty sequence.</li>\n\t<li><code>void append(val)</code> Appends an integer <code>val</code> to the end of the sequence.</li>\n\t<li><code>void addAll(inc)</code> Increments all existing values in the sequence by an integer <code>inc</code>.</li>\n\t<li><code>void multAll(m)</code> Multiplies all existing values in the sequence by an integer <code>m</code>.</li>\n\t<li><code>int getIndex(idx)</code> Gets the current value at index <code>idx</code> (0-indexed) of the sequence <strong>modulo</strong> <code>10<sup>9</sup> + 7</code>. If the index is greater or equal than the length of the sequence, return <code>-1</code>.</li>\n</ul>\n\n<p>&nbsp;</p>\n<p><strong class=\"example\">Example 1:</strong></p>\n\n<pre>\n<strong>Input</strong>\n[&quot;Fancy&quot;, &quot;append&quot;, &quot;addAll&quot;, &quot;append&quot;, &quot;multAll&quot;, &quot;getIndex&quot;, &quot;addAll&quot;, &quot;append&quot;, &quot;multAll&quot;, &quot;getIndex&quot;, &quot;getIndex&quot;, &quot;getIndex&quot;]\n[[], [2], [3], [7], [2], [0], [3], [10], [2], [0], [1], [2]]\n<strong>Output</strong>\n[null, null, null, null, null, 10, null, null, null, 26, 34, 20]\n\n<strong>Explanation</strong>\nFancy fancy = new Fancy();\nfancy.append(2);   // fancy sequence: [2]\nfancy.addAll(3);   // fancy sequence: [2+3] -&gt; [5]\nfancy.append(7);   // fancy sequence: [5, 7]\nfancy.multAll(2);  // fancy sequence: [5*2, 7*2] -&gt; [10, 14]\nfancy.getIndex(0); // return 10\nfancy.addAll(3);   // fancy sequence: [10+3, 14+3] -&gt; [13, 17]\nfancy.append(10);  // fancy sequence: [13, 17, 10]\nfancy.multAll(2);  // fancy sequence: [13*2, 17*2, 10*2] -&gt; [26, 34, 20]\nfancy.getIndex(0); // return 26\nfancy.getIndex(1); // return 34\nfancy.getIndex(2); // return 20\n</pre>\n\n<p>&nbsp;</p>\n<p><strong>Constraints:</strong></p>\n\n<ul>\n\t<li><code>1 &lt;= val, inc, m &lt;= 100</code></li>\n\t<li><code>0 &lt;= idx &lt;= 10<sup>5</sup></code></li>\n\t<li>At most <code>10<sup>5</sup></code> calls total will be made to <code>append</code>, <code>addAll</code>, <code>multAll</code>, and <code>getIndex</code>.</li>\n</ul>\n",
  "content_markdown": "Write an API that generates fancy sequences using the `append`, `addAll`, and `multAll` operations.\n\nImplement the `Fancy` class:\n\n  * `Fancy()` Initializes the object with an empty sequence.\n  * `void append(val)` Appends an integer `val` to the end of the sequence.\n  * `void addAll(inc)` Increments all existing values in the sequence by an integer `inc`.\n  * `void multAll(m)` Multiplies all existing values in the sequence by an integer `m`.\n  * `int getIndex(idx)` Gets the current value at index `idx` (0-indexed) of the sequence **modulo** `109 + 7`. If the index is greater or equal than the length of the sequence, return `-1`.\n\n\n\n \n\n**Example 1:**\n    \n    \n    **Input**\n    [\"Fancy\", \"append\", \"addAll\", \"append\", \"multAll\", \"getIndex\", \"addAll\", \"append\", \"multAll\", \"getIndex\", \"getIndex\", \"getIndex\"]\n    [[], [2], [3], [7], [2], [0], [3], [10], [2], [0], [1], [2]]\n    **Output**\n    [null, null, null, null, null, 10, null, null, null, 26, 34, 20]\n    \n    **Explanation**\n    Fancy fancy = new Fancy();\n    fancy.append(2);   // fancy sequence: [2]\n    fancy.addAll(3);   // fancy sequence: [2+3] -> [5]\n    fancy.append(7);   // fancy sequence: [5, 7]\n    fancy.multAll(2);  // fancy sequence: [5*2, 7*2] -> [10, 14]\n    fancy.getIndex(0); // return 10\n    fancy.addAll(3);   // fancy sequence: [10+3, 14+3] -> [13, 17]\n    fancy.append(10);  // fancy sequence: [13, 17, 10]\n    fancy.multAll(2);  // fancy sequence: [13*2, 17*2, 10*2] -> [26, 34, 20]\n    fancy.getIndex(0); // return 26\n    fancy.getIndex(1); // return 34\n    fancy.getIndex(2); // return 20\n    \n\n \n\n**Constraints:**\n\n  * `1 <= val, inc, m <= 100`\n  * `0 <= idx <= 105`\n  * At most `105` calls total will be made to `append`, `addAll`, `multAll`, and `getIndex`.",
  "question": "Write an API that generates fancy sequences using the `append`, `addAll`, and `multAll` operations.\n\nImplement the `Fancy` class:\n\n  * `Fancy()` Initializes the object with an empty sequence.\n  * `void append(val)` Appends an integer `val` to the end of the sequence.\n  * `void addAll(inc)` Increments all existing values in the sequence by an integer `inc`.\n  * `void multAll(m)` Multiplies all existing values in the sequence by an integer `m`.\n  * `int getIndex(idx)` Gets the current value at index `idx` (0-indexed) of the sequence **modulo** `109 + 7`. If the index is greater or equal than the length of the sequence, return `-1`.",
  "examples": "**Example 1:**\n    \n    \n    **Input**\n    [\"Fancy\", \"append\", \"addAll\", \"append\", \"multAll\", \"getIndex\", \"addAll\", \"append\", \"multAll\", \"getIndex\", \"getIndex\", \"getIndex\"]\n    [[], [2], [3], [7], [2], [0], [3], [10], [2], [0], [1], [2]]\n    **Output**\n    [null, null, null, null, null, 10, null, null, null, 26, 34, 20]\n    \n    **Explanation**\n    Fancy fancy = new Fancy();\n    fancy.append(2);   // fancy sequence: [2]\n    fancy.addAll(3);   // fancy sequence: [2+3] -> [5]\n    fancy.append(7);   // fancy sequence: [5, 7]\n    fancy.multAll(2);  // fancy sequence: [5*2, 7*2] -> [10, 14]\n    fancy.getIndex(0); // return 10\n    fancy.addAll(3);   // fancy sequence: [10+3, 14+3] -> [13, 17]\n    fancy.append(10);  // fancy sequence: [13, 17, 10]\n    fancy.multAll(2);  // fancy sequence: [13*2, 17*2, 10*2] -> [26, 34, 20]\n    fancy.getIndex(0); // return 26\n    fancy.getIndex(1); // return 34\n    fancy.getIndex(2); // return 20",
  "constraints": "**Constraints:**\n\n  * `1 <= val, inc, m <= 100`\n  * `0 <= idx <= 105`\n  * At most `105` calls total will be made to `append`, `addAll`, `multAll`, and `getIndex`.",
  "topics": ["Math", "Design", "Segment Tree"],
  "total_accepted": 15266,
  "total_submissions": 82075,
  "acceptance_rate": "18.6%",
  "similar_questions": [],
  "hints": [
    "Use two arrays to save the cumulative multipliers at each time point and cumulative sums adjusted by the current multiplier.",
    "The function getIndex(idx) ask to the current value modulo 10^9+7. Use modular inverse and both arrays to calculate this value."
  ]
}
