{
  "id": "2509",
  "title": "Cycle Length Queries in a Tree",
  "slug": "cycle-length-queries-in-a-tree",
  "difficulty": "Hard",
  "category": "Algorithms",
  "content_html": "<p>You are given an integer <code>n</code>. There is a <strong>complete binary tree</strong> with <code>2<sup>n</sup> - 1</code> nodes. The root of that tree is the node with the value <code>1</code>, and every node with a value <code>val</code> in the range <code>[1, 2<sup>n - 1</sup> - 1]</code> has two children where:</p>\n\n<ul>\n\t<li>The left node has the value <code>2 * val</code>, and</li>\n\t<li>The right node has the value <code>2 * val + 1</code>.</li>\n</ul>\n\n<p>You are also given a 2D integer array <code>queries</code> of length <code>m</code>, where <code>queries[i] = [a<sub>i</sub>, b<sub>i</sub>]</code>. For each query, solve the following problem:</p>\n\n<ol>\n\t<li>Add an edge between the nodes with values <code>a<sub>i</sub></code> and <code>b<sub>i</sub></code>.</li>\n\t<li>Find the length of the cycle in the graph.</li>\n\t<li>Remove the added edge between nodes with values <code>a<sub>i</sub></code> and <code>b<sub>i</sub></code>.</li>\n</ol>\n\n<p><strong>Note</strong> that:</p>\n\n<ul>\n\t<li>A <strong>cycle</strong> is a path that starts and ends at the same node, and each edge in the path is visited only once.</li>\n\t<li>The length of a cycle is the number of edges visited in the cycle.</li>\n\t<li>There could be multiple edges between two nodes in the tree after adding the edge of the query.</li>\n</ul>\n\n<p>Return <em>an array </em><code>answer</code><em> of length </em><code>m</code><em> where</em> <code>answer[i]</code> <em>is the answer to the</em> <code>i<sup>th</sup></code> <em>query.</em></p>\n\n<p>&nbsp;</p>\n<p><strong class=\"example\">Example 1:</strong></p>\n<img alt=\"\" src=\"https://assets.leetcode.com/uploads/2022/10/25/bexample1.png\" style=\"width: 647px; height: 128px;\" />\n<pre>\n<strong>Input:</strong> n = 3, queries = [[5,3],[4,7],[2,3]]\n<strong>Output:</strong> [4,5,3]\n<strong>Explanation:</strong> The diagrams above show the tree of 2<sup>3</sup> - 1 nodes. Nodes colored in red describe the nodes in the cycle after adding the edge.\n- After adding the edge between nodes 3 and 5, the graph contains a cycle of nodes [5,2,1,3]. Thus answer to the first query is 4. We delete the added edge and process the next query.\n- After adding the edge between nodes 4 and 7, the graph contains a cycle of nodes [4,2,1,3,7]. Thus answer to the second query is 5. We delete the added edge and process the next query.\n- After adding the edge between nodes 2 and 3, the graph contains a cycle of nodes [2,1,3]. Thus answer to the third query is 3. We delete the added edge.\n</pre>\n\n<p><strong class=\"example\">Example 2:</strong></p>\n<img alt=\"\" src=\"https://assets.leetcode.com/uploads/2022/10/25/aexample2.png\" style=\"width: 146px; height: 71px;\" />\n<pre>\n<strong>Input:</strong> n = 2, queries = [[1,2]]\n<strong>Output:</strong> [2]\n<strong>Explanation:</strong> The diagram above shows the tree of 2<sup>2</sup> - 1 nodes. Nodes colored in red describe the nodes in the cycle after adding the edge.\n- After adding the edge between nodes 1 and 2, the graph contains a cycle of nodes [2,1]. Thus answer for the first query is 2. We delete the added edge.\n</pre>\n\n<p>&nbsp;</p>\n<p><strong>Constraints:</strong></p>\n\n<ul>\n\t<li><code>2 &lt;= n &lt;= 30</code></li>\n\t<li><code>m == queries.length</code></li>\n\t<li><code>1 &lt;= m &lt;= 10<sup>5</sup></code></li>\n\t<li><code>queries[i].length == 2</code></li>\n\t<li><code>1 &lt;= a<sub>i</sub>, b<sub>i</sub> &lt;= 2<sup>n</sup> - 1</code></li>\n\t<li><code>a<sub>i</sub> != b<sub>i</sub></code></li>\n</ul>\n",
  "content_markdown": "You are given an integer `n`. There is a **complete binary tree** with `2n - 1` nodes. The root of that tree is the node with the value `1`, and every node with a value `val` in the range `[1, 2n - 1 - 1]` has two children where:\n\n  * The left node has the value `2 * val`, and\n  * The right node has the value `2 * val + 1`.\n\n\n\nYou are also given a 2D integer array `queries` of length `m`, where `queries[i] = [ai, bi]`. For each query, solve the following problem:\n\n  1. Add an edge between the nodes with values `ai` and `bi`.\n  2. Find the length of the cycle in the graph.\n  3. Remove the added edge between nodes with values `ai` and `bi`.\n\n\n\n**Note** that:\n\n  * A **cycle** is a path that starts and ends at the same node, and each edge in the path is visited only once.\n  * The length of a cycle is the number of edges visited in the cycle.\n  * There could be multiple edges between two nodes in the tree after adding the edge of the query.\n\n\n\nReturn _an array_`answer` _of length_`m` _where_ `answer[i]` _is the answer to the_ `ith` _query._\n\n \n\n**Example 1:**\n\n![](https://assets.leetcode.com/uploads/2022/10/25/bexample1.png)\n    \n    \n    **Input:** n = 3, queries = [[5,3],[4,7],[2,3]]\n    **Output:** [4,5,3]\n    **Explanation:** The diagrams above show the tree of 23 - 1 nodes. Nodes colored in red describe the nodes in the cycle after adding the edge.\n    - After adding the edge between nodes 3 and 5, the graph contains a cycle of nodes [5,2,1,3]. Thus answer to the first query is 4. We delete the added edge and process the next query.\n    - After adding the edge between nodes 4 and 7, the graph contains a cycle of nodes [4,2,1,3,7]. Thus answer to the second query is 5. We delete the added edge and process the next query.\n    - After adding the edge between nodes 2 and 3, the graph contains a cycle of nodes [2,1,3]. Thus answer to the third query is 3. We delete the added edge.\n    \n\n**Example 2:**\n\n![](https://assets.leetcode.com/uploads/2022/10/25/aexample2.png)\n    \n    \n    **Input:** n = 2, queries = [[1,2]]\n    **Output:** [2]\n    **Explanation:** The diagram above shows the tree of 22 - 1 nodes. Nodes colored in red describe the nodes in the cycle after adding the edge.\n    - After adding the edge between nodes 1 and 2, the graph contains a cycle of nodes [2,1]. Thus answer for the first query is 2. We delete the added edge.\n    \n\n \n\n**Constraints:**\n\n  * `2 <= n <= 30`\n  * `m == queries.length`\n  * `1 <= m <= 105`\n  * `queries[i].length == 2`\n  * `1 <= ai, bi <= 2n - 1`\n  * `ai != bi`",
  "question": "You are given an integer `n`. There is a **complete binary tree** with `2n - 1` nodes. The root of that tree is the node with the value `1`, and every node with a value `val` in the range `[1, 2n - 1 - 1]` has two children where:\n\n  * The left node has the value `2 * val`, and\n  * The right node has the value `2 * val + 1`.\n\n\n\nYou are also given a 2D integer array `queries` of length `m`, where `queries[i] = [ai, bi]`. For each query, solve the following problem:\n\n  1. Add an edge between the nodes with values `ai` and `bi`.\n  2. Find the length of the cycle in the graph.\n  3. Remove the added edge between nodes with values `ai` and `bi`.\n\n\n\n**Note** that:\n\n  * A **cycle** is a path that starts and ends at the same node, and each edge in the path is visited only once.\n  * The length of a cycle is the number of edges visited in the cycle.\n  * There could be multiple edges between two nodes in the tree after adding the edge of the query.\n\n\n\nReturn _an array_`answer` _of length_`m` _where_ `answer[i]` _is the answer to the_ `ith` _query._",
  "examples": "**Example 1:**\n\n![](https://assets.leetcode.com/uploads/2022/10/25/bexample1.png)\n    \n    \n    **Input:** n = 3, queries = [[5,3],[4,7],[2,3]]\n    **Output:** [4,5,3]\n    **Explanation:** The diagrams above show the tree of 23 - 1 nodes. Nodes colored in red describe the nodes in the cycle after adding the edge.\n    - After adding the edge between nodes 3 and 5, the graph contains a cycle of nodes [5,2,1,3]. Thus answer to the first query is 4. We delete the added edge and process the next query.\n    - After adding the edge between nodes 4 and 7, the graph contains a cycle of nodes [4,2,1,3,7]. Thus answer to the second query is 5. We delete the added edge and process the next query.\n    - After adding the edge between nodes 2 and 3, the graph contains a cycle of nodes [2,1,3]. Thus answer to the third query is 3. We delete the added edge.\n    \n\n**Example 2:**\n\n![](https://assets.leetcode.com/uploads/2022/10/25/aexample2.png)\n    \n    \n    **Input:** n = 2, queries = [[1,2]]\n    **Output:** [2]\n    **Explanation:** The diagram above shows the tree of 22 - 1 nodes. Nodes colored in red describe the nodes in the cycle after adding the edge.\n    - After adding the edge between nodes 1 and 2, the graph contains a cycle of nodes [2,1]. Thus answer for the first query is 2. We delete the added edge.",
  "constraints": "**Constraints:**\n\n  * `2 <= n <= 30`\n  * `m == queries.length`\n  * `1 <= m <= 105`\n  * `queries[i].length == 2`\n  * `1 <= ai, bi <= 2n - 1`\n  * `ai != bi`",
  "topics": ["Array", "Tree", "Binary Tree"],
  "total_accepted": 19026,
  "total_submissions": 31615,
  "acceptance_rate": "60.2%",
  "similar_questions": [
    {
      "title": "Populating Next Right Pointers in Each Node",
      "slug": "populating-next-right-pointers-in-each-node",
      "difficulty": "Medium",
      "url": "https://leetcode.com/problems/populating-next-right-pointers-in-each-node/"
    },
    {
      "title": "Lowest Common Ancestor of a Binary Tree",
      "slug": "lowest-common-ancestor-of-a-binary-tree",
      "difficulty": "Medium",
      "url": "https://leetcode.com/problems/lowest-common-ancestor-of-a-binary-tree/"
    },
    {
      "title": "Path In Zigzag Labelled Binary Tree",
      "slug": "path-in-zigzag-labelled-binary-tree",
      "difficulty": "Medium",
      "url": "https://leetcode.com/problems/path-in-zigzag-labelled-binary-tree/"
    }
  ],
  "hints": [
    "Find the distance between nodes “a” and “b”.",
    "distance(a, b) = depth(a) + depth(b) - 2 * depth(LCA(a, b)). Where depth(a) denotes depth from root to node “a” and LCA(a, b) denotes the lowest common ancestor of nodes “a” and “b”.",
    "To find LCA(a, b), iterate over all ancestors of node “a” and check if it is the ancestor of node “b” too. If so, take the one with maximum depth."
  ]
}
