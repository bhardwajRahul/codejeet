{
  "id": "3671",
  "title": "Sum of Beautiful Subsequences",
  "slug": "sum-of-beautiful-subsequences",
  "difficulty": "Hard",
  "category": "Algorithms",
  "content_html": "<p>You are given an integer array <code>nums</code> of length <code>n</code>.</p>\n\n<p>For every <strong>positive</strong> integer <code>g</code>, we define the <strong>beauty</strong> of <code>g</code> as the <strong>product</strong> of <code>g</code> and the number of <strong>strictly increasing</strong> <strong><span data-keyword=\"subsequence-array-nonempty\">subsequences</span></strong> of <code>nums</code> whose greatest common divisor (GCD) is exactly <code>g</code>.</p>\n\n<p>Return the <strong>sum</strong> of <strong>beauty</strong> values for all positive integers <code>g</code>.</p>\n\n<p>Since the answer could be very large, return it modulo <code>10<sup>9</sup> + 7</code>.</p>\n\n<p>&nbsp;</p>\n<p><strong class=\"example\">Example 1:</strong></p>\n\n<div class=\"example-block\">\n<p><strong>Input:</strong> <span class=\"example-io\">nums = [1,2,3]</span></p>\n\n<p><strong>Output:</strong> <span class=\"example-io\">10</span></p>\n\n<p><strong>Explanation:</strong></p>\n\n<p>All strictly increasing subsequences and their GCDs are:</p>\n\n<table style=\"border: 1px solid black;\">\n\t<thead>\n\t\t<tr>\n\t\t\t<th style=\"border: 1px solid black;\">Subsequence</th>\n\t\t\t<th style=\"border: 1px solid black;\">GCD</th>\n\t\t</tr>\n\t</thead>\n\t<tbody>\n\t\t<tr>\n\t\t\t<td style=\"border: 1px solid black;\">[1]</td>\n\t\t\t<td style=\"border: 1px solid black;\">1</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border: 1px solid black;\">[2]</td>\n\t\t\t<td style=\"border: 1px solid black;\">2</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border: 1px solid black;\">[3]</td>\n\t\t\t<td style=\"border: 1px solid black;\">3</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border: 1px solid black;\">[1,2]</td>\n\t\t\t<td style=\"border: 1px solid black;\">1</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border: 1px solid black;\">[1,3]</td>\n\t\t\t<td style=\"border: 1px solid black;\">1</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border: 1px solid black;\">[2,3]</td>\n\t\t\t<td style=\"border: 1px solid black;\">1</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border: 1px solid black;\">[1,2,3]</td>\n\t\t\t<td style=\"border: 1px solid black;\">1</td>\n\t\t</tr>\n\t</tbody>\n</table>\n\n<p>Calculating beauty for each GCD:</p>\n\n<table style=\"border: 1px solid black;\">\n\t<thead>\n\t\t<tr>\n\t\t\t<th style=\"border: 1px solid black;\">GCD</th>\n\t\t\t<th style=\"border: 1px solid black;\">Count of subsequences</th>\n\t\t\t<th style=\"border: 1px solid black;\">Beauty (GCD &times; Count)</th>\n\t\t</tr>\n\t</thead>\n\t<tbody>\n\t\t<tr>\n\t\t\t<td style=\"border: 1px solid black;\">1</td>\n\t\t\t<td style=\"border: 1px solid black;\">5</td>\n\t\t\t<td style=\"border: 1px solid black;\">1 &times; 5 = 5</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border: 1px solid black;\">2</td>\n\t\t\t<td style=\"border: 1px solid black;\">1</td>\n\t\t\t<td style=\"border: 1px solid black;\">2 &times; 1 = 2</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border: 1px solid black;\">3</td>\n\t\t\t<td style=\"border: 1px solid black;\">1</td>\n\t\t\t<td style=\"border: 1px solid black;\">3 &times; 1 = 3</td>\n\t\t</tr>\n\t</tbody>\n</table>\n\n<p>Total beauty is <code>5 + 2 + 3 = 10</code>.</p>\n</div>\n\n<p><strong class=\"example\">Example 2:</strong></p>\n\n<div class=\"example-block\">\n<p><strong>Input:</strong> <span class=\"example-io\">nums = [4,6]</span></p>\n\n<p><strong>Output:</strong> <span class=\"example-io\">12</span></p>\n\n<p><strong>Explanation:</strong></p>\n\n<p>All strictly increasing subsequences and their GCDs are:</p>\n\n<table style=\"border: 1px solid black;\">\n\t<thead>\n\t\t<tr>\n\t\t\t<th style=\"border: 1px solid black;\">Subsequence</th>\n\t\t\t<th style=\"border: 1px solid black;\">GCD</th>\n\t\t</tr>\n\t</thead>\n\t<tbody>\n\t\t<tr>\n\t\t\t<td style=\"border: 1px solid black;\">[4]</td>\n\t\t\t<td style=\"border: 1px solid black;\">4</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border: 1px solid black;\">[6]</td>\n\t\t\t<td style=\"border: 1px solid black;\">6</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border: 1px solid black;\">[4,6]</td>\n\t\t\t<td style=\"border: 1px solid black;\">2</td>\n\t\t</tr>\n\t</tbody>\n</table>\n\n<p>Calculating beauty for each GCD:</p>\n\n<table style=\"border: 1px solid black;\">\n\t<thead>\n\t\t<tr>\n\t\t\t<th style=\"border: 1px solid black;\">GCD</th>\n\t\t\t<th style=\"border: 1px solid black;\">Count of subsequences</th>\n\t\t\t<th style=\"border: 1px solid black;\">Beauty (GCD &times; Count)</th>\n\t\t</tr>\n\t</thead>\n\t<tbody>\n\t\t<tr>\n\t\t\t<td style=\"border: 1px solid black;\">2</td>\n\t\t\t<td style=\"border: 1px solid black;\">1</td>\n\t\t\t<td style=\"border: 1px solid black;\">2 &times; 1 = 2</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border: 1px solid black;\">4</td>\n\t\t\t<td style=\"border: 1px solid black;\">1</td>\n\t\t\t<td style=\"border: 1px solid black;\">4 &times; 1 = 4</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td style=\"border: 1px solid black;\">6</td>\n\t\t\t<td style=\"border: 1px solid black;\">1</td>\n\t\t\t<td style=\"border: 1px solid black;\">6 &times; 1 = 6</td>\n\t\t</tr>\n\t</tbody>\n</table>\n\n<p>Total beauty is <code>2 + 4 + 6 = 12</code>.</p>\n</div>\n\n<p>&nbsp;</p>\n<p><strong>Constraints:</strong></p>\n\n<ul>\n\t<li><code>1 &lt;= n == nums.length &lt;= 10<sup>4</sup></code></li>\n\t<li><code>1 &lt;= nums[i] &lt;= 7 * 10<sup>4</sup></code></li>\n</ul>\n",
  "content_markdown": "You are given an integer array `nums` of length `n`.\n\nFor every **positive** integer `g`, we define the **beauty** of `g` as the **product** of `g` and the number of **strictly increasing** **subsequences** of `nums` whose greatest common divisor (GCD) is exactly `g`.\n\nReturn the **sum** of **beauty** values for all positive integers `g`.\n\nSince the answer could be very large, return it modulo `109 + 7`.\n\n \n\n**Example 1:**\n\n**Input:** nums = [1,2,3]\n\n**Output:** 10\n\n**Explanation:**\n\nAll strictly increasing subsequences and their GCDs are:\n\nSubsequence | GCD  \n---|---  \n[1] | 1  \n[2] | 2  \n[3] | 3  \n[1,2] | 1  \n[1,3] | 1  \n[2,3] | 1  \n[1,2,3] | 1  \n  \nCalculating beauty for each GCD:\n\nGCD | Count of subsequences | Beauty (GCD × Count)  \n---|---|---  \n1 | 5 | 1 × 5 = 5  \n2 | 1 | 2 × 1 = 2  \n3 | 1 | 3 × 1 = 3  \n  \nTotal beauty is `5 + 2 + 3 = 10`.\n\n**Example 2:**\n\n**Input:** nums = [4,6]\n\n**Output:** 12\n\n**Explanation:**\n\nAll strictly increasing subsequences and their GCDs are:\n\nSubsequence | GCD  \n---|---  \n[4] | 4  \n[6] | 6  \n[4,6] | 2  \n  \nCalculating beauty for each GCD:\n\nGCD | Count of subsequences | Beauty (GCD × Count)  \n---|---|---  \n2 | 1 | 2 × 1 = 2  \n4 | 1 | 4 × 1 = 4  \n6 | 1 | 6 × 1 = 6  \n  \nTotal beauty is `2 + 4 + 6 = 12`.\n\n \n\n**Constraints:**\n\n  * `1 <= n == nums.length <= 104`\n  * `1 <= nums[i] <= 7 * 104`",
  "question": "You are given an integer array `nums` of length `n`.\n\nFor every **positive** integer `g`, we define the **beauty** of `g` as the **product** of `g` and the number of **strictly increasing** **subsequences** of `nums` whose greatest common divisor (GCD) is exactly `g`.\n\nReturn the **sum** of **beauty** values for all positive integers `g`.\n\nSince the answer could be very large, return it modulo `109 + 7`.",
  "examples": "**Example 1:**\n\n**Input:** nums = [1,2,3]\n\n**Output:** 10\n\n**Explanation:**\n\nAll strictly increasing subsequences and their GCDs are:\n\nSubsequence | GCD  \n---|---  \n[1] | 1  \n[2] | 2  \n[3] | 3  \n[1,2] | 1  \n[1,3] | 1  \n[2,3] | 1  \n[1,2,3] | 1  \n  \nCalculating beauty for each GCD:\n\nGCD | Count of subsequences | Beauty (GCD × Count)  \n---|---|---  \n1 | 5 | 1 × 5 = 5  \n2 | 1 | 2 × 1 = 2  \n3 | 1 | 3 × 1 = 3  \n  \nTotal beauty is `5 + 2 + 3 = 10`.\n\n**Example 2:**\n\n**Input:** nums = [4,6]\n\n**Output:** 12\n\n**Explanation:**\n\nAll strictly increasing subsequences and their GCDs are:\n\nSubsequence | GCD  \n---|---  \n[4] | 4  \n[6] | 6  \n[4,6] | 2  \n  \nCalculating beauty for each GCD:\n\nGCD | Count of subsequences | Beauty (GCD × Count)  \n---|---|---  \n2 | 1 | 2 × 1 = 2  \n4 | 1 | 4 × 1 = 4  \n6 | 1 | 6 × 1 = 6  \n  \nTotal beauty is `2 + 4 + 6 = 12`.",
  "constraints": "**Constraints:**\n\n  * `1 <= n == nums.length <= 104`\n  * `1 <= nums[i] <= 7 * 104`",
  "topics": ["Array", "Math", "Binary Indexed Tree", "Number Theory"],
  "total_accepted": 8902,
  "total_submissions": 28474,
  "acceptance_rate": "31.3%",
  "similar_questions": [],
  "hints": [
    "Fix a candidate GCD <code>g</code> and keep, in the original order, only those array elements divisible by <code>g</code>; scale them down to <code>x / g</code> so any increasing subsequence here corresponds to a subsequence whose elements are all multiples of <code>g</code>.",
    "Count strictly increasing subsequences of that scaled list by assigning ranks (coordinate compression) and maintaining prefix sums of ways for smaller ranks (you may use a Fenwick tree).",
    "The count you get, call it <code>cnt_g</code>, includes subsequences whose GCD is <code>g</code> or any multiple of <code>g</code>; it is therefore an overcount for \"exactly g\".",
    "To get the number with GCD exactly <code>g</code>, process <code>g</code> from <code>max(nums)</code> down to <code>1</code> and subtract counts already assigned to multiples: <code>F[g] = cnt_g - sum{k=2g,3g,...}*F[k]</code> (do arithmetic mod <code>MOD</code>); descending order ensures multiples are known.",
    "The final answer is the sum of contributions <code>g * F[g]</code> for all <code>g</code>."
  ]
}
